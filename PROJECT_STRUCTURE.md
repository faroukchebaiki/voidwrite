# Project Structure

- `.env.example` — Template env variables for local setup with guidance comments.
- `.env.local` — Developer-specific environment overrides used by Next.js (ignored by git).
- `.gitignore` — Patterns keeping build outputs, dependencies, and local secrets out of version control.
- `LICENSE` — MIT license covering the Voidwrite project.
- `README.md` — Project overview, setup steps, and feature documentation.
- `auth-app.ts` — NextAuth server configuration with credentials/passkey providers and Drizzle adapter.
- `auth-middleware.ts` — Lightweight NextAuth setup for middleware-based JWT session checks.
- `components.json` — shadcn/ui CLI configuration with path aliases and style presets.
- `drizzle.config.ts` — Drizzle Kit CLI configuration (schema sources, output folder, env loading).
- `env.d.ts` — TypeScript declarations for the required `process.env` keys.
- `eslint.config.mjs` — Flat ESLint configuration extending Next defaults with repo-specific rules.
- `middleware.ts` — Next.js middleware enforcing studio access control and redirecting signed-in auth pages.
- `next-env.d.ts` — Generated Next.js type references (do not edit).
- `next.config.ts` — Next.js runtime configuration (e.g., remote image allowlist).
- `package.json` — Package metadata plus scripts for dev, build, lint, and database tasks.
- `pnpm-lock.yaml` — Locked dependency graph for reproducible installs.
- `pnpm-workspace.yaml` — PNPM workspace settings (ignored built dependencies like `argon2`).
- `postcss.config.mjs` — PostCSS pipeline definition leveraging Tailwind’s plugin.
- `tsconfig.json` — TypeScript compiler configuration for the App Router project.
- `tsconfig.tsbuildinfo` — TypeScript incremental build cache generated by `tsc`.
- `styles/` — Global CSS assets and theme tokens.
  - `editor.css` — TipTap editor chrome styles and formatting toolbar rules.
  - `theme.css` — Basic CSS variable theme definitions for light/dark fallbacks.
- `hooks/` — Shared React hooks.
  - `use-mobile.ts` — `useIsMobile` hook using `matchMedia` to detect narrow viewports.
- `components/` — React components for the public site and studio interface.
  - `AdminControls.tsx` — Admin panel for changing roles, suspending, or deleting members.
  - `AnalyticsChart.tsx` — Client component fetching analytics data and rendering a Recharts area chart.
  - `AnalyticsClient.tsx` — Thin wrapper mounting `AnalyticsChart` on the client.
  - `Footer.tsx` — Public site footer hidden on studio routes.
  - `Header.tsx` — Public header with search box and theme toggle.
  - `NewPostClient.tsx` — Client-side new post form with TipTap editor and cover uploads.
  - `PostEditor.tsx` — Editor experience for updating posts, status, assignees, and admin notes.
  - `PostsTableClient.tsx` — Interactive posts table with filters, pagination, and actions.
  - `RichEditor.tsx` — TipTap-based rich text editor with uploads, embeds, and formatting controls.
  - `SettingsForm.tsx` — Admin form for updating global site settings via the API.
  - `SettingsSingle.tsx` — User profile/security settings (avatar, bio, passkeys, theme, credentials).
  - `SignOutButton.tsx` — Reusable button that triggers NextAuth `signOut` with a callback URL.
  - `UserCombobox.tsx` — Keyboard-friendly combobox for selecting users from `/api/users`.
  - `UserSelect.tsx` — Simplified dropdown selector for users, cached client-side.
  - `ViewTracker.tsx` — Client effect that records post views once per visitor per day.
  - `app-sidebar.tsx` — Studio sidebar shell with role-aware navigation and user menu.
  - `nav-documents.tsx` — Sidebar section for linking to “documents” with action menus.
  - `nav-main.tsx` — Main studio navigation that tracks the active route key.
  - `nav-secondary.tsx` — Secondary sidebar navigation block for auxiliary links.
  - `nav-user.tsx` — Sidebar user dropdown with account links and avatar sync via localStorage.
  - `site-header.tsx` — Sticky studio header showing context-aware titles and actions.
  - `ui/` — Shadcn-derived UI primitives tailored to the design system.
    - `avatar.tsx` — Avatar component for user images and fallback initials.
    - `badge.tsx` — Styled badge/pill component with variants.
    - `breadcrumb.tsx` — Breadcrumb navigation primitives.
    - `button.tsx` — Variant-aware button component built with `cva`.
    - `card.tsx` — Card container primitives.
    - `chart.tsx` — Theming helpers and tooltip wrapper for Recharts charts.
    - `checkbox.tsx` — Checkbox component wrapping Radix checkbox.
    - `drawer.tsx` — Drawer component built on Radix dialog primitives.
    - `dropdown-menu.tsx` — Dropdown menu primitives for contextual actions.
    - `input.tsx` — Styled text input wired to Tailwind tokens.
    - `label.tsx` — Accessible form label component.
    - `select.tsx` — Radix select wrapper with consistent styling.
    - `separator.tsx` — Horizontal/vertical divider element.
    - `sheet.tsx` — Sliding sheet panel primitives.
    - `sidebar.tsx` — Responsive sidebar layout primitives used across Studio.
    - `skeleton.tsx` — Loading skeleton components.
    - `sonner.tsx` — Client provider for the Sonner toast system.
    - `table.tsx` — Table primitives used by the posts list UI.
    - `tabs.tsx` — Tabs component built on Radix tabs.
    - `toggle-group.tsx` — Toggle group wrapper with styling.
    - `toggle.tsx` — Toggle button component.
    - `tooltip.tsx` — Tooltip primitives built on Radix tooltip.
- `drizzle/` — Generated SQL migrations and metadata snapshots.
  - `0000_deep_blue_blade.sql` — Initial migration creating the core CMS/auth tables.
  - `0001_cuddly_red_ghost.sql` — Migration refining schema after the base release.
  - `0002_cloudy_nuke.sql` — Migration adding additional CMS features/columns.
  - `0003_premium_lord_hawal.sql` — Migration covering notifications/analytics updates.
  - `0004_worried_boomerang.sql` — Latest schema adjustments applied.
  - `meta/` — Drizzle migration metadata for drift tracking.
    - `0000_snapshot.json` — Snapshot of schema at migration 0.
    - `0001_snapshot.json` — Snapshot of schema at migration 1.
    - `0002_snapshot.json` — Snapshot of schema at migration 2.
    - `0003_snapshot.json` — Snapshot of schema at migration 3.
    - `0004_snapshot.json` — Snapshot of schema at migration 4.
    - `_journal.json` — Drizzle migration journal tracking execution history.
- `scripts/` — Utility scripts for provisioning and diagnostics.
  - `check-auth.ts` — Verifies credentials login for a given email/password against the database.
  - `seed-demo.ts` — Seeds demo admins, authors, tags, and posts with lorem ipsum content.
  - `seed.ts` — Seeds default settings and an admin user driven by env variables.
- `lib/` — Shared utilities and adapters.
  - `analytics.ts` — Re-export of Vercel Analytics client component.
  - `auth-helpers.ts` — Helper functions to require user/admin sessions and master checks.
  - `env.ts` — Runtime validation for required server environment variables.
  - `markdown.ts` — Markdown rendering with sanitize-html sanitization.
  - `password.ts` — Password hashing/verification using `argon2` or `@node-rs/argon2` fallback.
  - `utils.ts` — `cn` helper combining Tailwind class strings.
  - `validation.ts` — Zod schemas for posts, tags, settings, profile updates, assignments, and signup.
- `db/` — Database connection and schema definitions.
  - `auth-schema.ts` — Auth.js adapter tables (users, accounts, sessions, authenticators).
  - `index.ts` — Drizzle client initialization with a Postgres connection pool.
  - `schema.ts` — CMS-specific tables (profiles, posts, tags, settings, analytics, notifications).
- `app/` — Next.js App Router pages, layouts, and API routes.
  - `globals.css` — Tailwind v4 layer definitions and CSS custom properties.
  - `layout.tsx` — Root layout wiring the theme provider, header/footer, and analytics.
  - `page.tsx` — Public landing page listing published posts and tags.
  - `api/` — HTTP endpoints powering the CMS.
    - `views/route.ts` — Increments post views and daily aggregates with cookie throttling.
    - `views/[slug]/` — Empty placeholder directory reserved for possible nested view routes.
    - `notifications/route.ts` — Lists notifications and marks them as read for staff.
    - `tags/route.ts` — Admin CRUD endpoints for tags.
    - `account/passkeys/route.ts` — Removes stored passkeys through the NextAuth authenticators table.
    - `account/password/route.ts` — Updates the current user’s credentials password hash.
    - `account/email/route.ts` — Changes the signed-in user’s email address.
    - `settings/route.ts` — Fetches and updates global site settings (admin only).
    - `invites/route.ts` — Admin endpoints for listing and creating invite codes.
    - `users/route.ts` — Admin-only list of users with profile metadata.
    - `users/[id]/route.ts` — Deletes a user after transferring their content elsewhere.
    - `users/[id]/suspend/route.ts` — Toggles a user’s suspended flag (admin only).
    - `users/[id]/role/route.ts` — Updates a user’s role while guarding the master admin.
    - `posts/route.ts` — Lists posts and creates new ones (admin publish support).
    - `posts/[id]/route.ts` — Fetches, updates, or deletes a specific post.
    - `posts/[id]/publish/route.ts` — Marks a post as published and notifies the author.
    - `posts/[id]/submit/route.ts` — Submits a post for review and notifies admins.
    - `posts/[id]/assign/route.ts` — Assigns a post to a staff member and sends a notification.
    - `upload/route.ts` — Validated image upload to Vercel Blob storage.
    - `analytics/views/route.ts` — Returns aggregated visitor counts for dashboard charts.
    - `auth/signup/route.ts` — Handles user signup with invite enforcement and initial admin bootstrap.
    - `auth/[...nextauth]/route.ts` — NextAuth request handler passthrough.
    - `profile/route.ts` — Gets or updates the signed-in user’s profile fields.
  - `studio/` — Authenticated writer/admin dashboard.
    - `layout.tsx` — Studio layout providing the sidebar and header shell.
    - `page.tsx` — Dashboard metrics overview (posts and visitor counts).
    - `my-blogs/page.tsx` — Author-focused table of the signed-in user’s posts.
    - `myblogs/` — Empty folder kept for a legacy slug; contains no files.
    - `notifications/page.tsx` — Lists notifications for the signed-in staff member.
    - `pending/client.tsx` — Client UI for managing submitted posts and admin actions.
    - `pending/page.tsx` — Server page loading submitted posts and rendering the pending client.
    - `tags/client.tsx` — Client UI for creating, editing, and deleting tags.
    - `tags/page.tsx` — Admin tag management page that loads tag data.
    - `settings/page.tsx` — Studio settings page combining site and personal preferences.
    - `members/page.tsx` — Members list showing admins/authors and post counts.
    - `members/[id]/page.tsx` — Admin detail view for a specific member with controls.
    - `invite/client.tsx` — Client UI to generate and copy invite codes.
    - `invite/page.tsx` — Admin invite management page fetching invite history.
    - `posts/page.tsx` — Admin “All posts” table with filters and pagination.
    - `posts/new/page.tsx` — Loader that renders the new-post client editor.
    - `posts/[id]/page.tsx` — Server loader hydrating the post editor for a given ID.
  - `tag/[slug]/page.tsx` — Public tag page listing associated published posts.
  - `signup/page.tsx` — Signup form hitting the signup API and handling invites.
  - `login/` — Empty directory placeholder for a future login route.
  - `rss.xml/route.ts` — Generates an RSS feed for published posts.
  - `sitemap.xml/route.ts` — Builds an XML sitemap covering posts and tags.
  - `posts/[slug]/page.tsx` — Public post page rendering markdown content and tracking views.
  - `signin/page.tsx` — Sign-in form supporting credentials and passkeys.

